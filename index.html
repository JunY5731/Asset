<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>자산/소모품 대여 관리</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React & ReactDOM CDN (카메라/React 훅 사용을 위해 먼저 로드) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <!-- jsQR 라이브러리 CDN -->
  <script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.js"></script>
  <!-- Babel Standalone for JSX -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // QR AUTO ITEM LOG START
    // 품목 매핑 상수
    const ITEM_MAP = {
      ITEM_01: "각티슈",
      ITEM_02: "물티슈",
      ITEM_03: "볼펜",
      ITEM_04: "풀",
      ITEM_05: "네임펜"
    };

    // QR 스캔 유틸리티 함수
    const scanQRFromVideo = async (video, canvas, scanDuration = 2000, interval = 200) => {
      const detectedQRs = new Set();
      const startTime = Date.now();
      
      return new Promise((resolve) => {
        const scanInterval = setInterval(() => {
          try {
            const ctx = canvas.getContext('2d');
            canvas.width = video.videoWidth;
            canvas.height = video.videoHeight;
            ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);
            
            if (code && code.data) {
              const qrId = code.data.trim();
              // ITEM_XX 형식인지 확인
              if (qrId.startsWith('ITEM_') && ITEM_MAP[qrId]) {
                detectedQRs.add(qrId);
              }
            }
          } catch (error) {
            console.error('QR scan error:', error);
          }
          
          if (Date.now() - startTime >= scanDuration) {
            clearInterval(scanInterval);
            resolve(Array.from(detectedQRs));
          }
        }, interval);
      });
    };
    // QR AUTO ITEM LOG END

    // 대여 모달 컴포넌트
    function LoanModal({ open, onClose, onConfirm }) {
      const [borrowerName, setBorrowerName] = useState('');
      const [borrowerTeam, setBorrowerTeam] = useState('');
      const [itemsTaken, setItemsTaken] = useState([]);
      const [availableItems, setAvailableItems] = useState([]);
      const [isProcessing, setIsProcessing] = useState(false);
      
      // QR AUTO ITEM LOG START
      // QR 스캔 관련 상태
      const [qrEnabled, setQrEnabled] = useState(false);
      const [qrStatus, setQrStatus] = useState('카메라 대기 중...');
      const [beforeQRs, setBeforeQRs] = useState([]);
      const [isScanning, setIsScanning] = useState(false);
      const [selectedItems, setSelectedItems] = useState([]);
      
      const qrVideoRef = useRef(null);
      const qrCanvasRef = useRef(null);
      const qrStreamRef = useRef(null);
      const scanIntervalRef = useRef(null);
      // QR AUTO ITEM LOG END

      // CAMERA SELECT START
      // 카메라 장치 목록 및 선택 상태
      const [devices, setDevices] = useState([]);
      const [faceCameraId, setFaceCameraId] = useState('');
      const [shelfCameraId, setShelfCameraId] = useState('');
      // CAMERA SELECT END

      // 얼굴인식 관련 (기존 또는 추가 예정)
      const faceVideoRef = useRef(null);
      const faceStreamRef = useRef(null);

      // CAMERA SELECT START
      // 비디오 입력 장치 목록 로드 (권한 획득 후 라벨 갱신)
      useEffect(() => {
        if (open) {
          let tempStream = null;

          const initDevices = async () => {
            try {
              // 권한 요청 (기본 카메라) - 라벨을 얻기 위해 필요
              tempStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: false });

              // 장치 목록 조회 (권한 후 라벨 포함)
              const allDevices = await navigator.mediaDevices.enumerateDevices();
              const videoInputs = allDevices.filter(device => device.kind === 'videoinput');
              setDevices(videoInputs);

              // 기본 선택값 설정
              if (videoInputs.length >= 2) {
                setFaceCameraId(prev => prev || videoInputs[0].deviceId);
                setShelfCameraId(prev => prev || videoInputs[1].deviceId);
              } else if (videoInputs.length === 1) {
                setFaceCameraId(prev => prev || videoInputs[0].deviceId);
                setShelfCameraId(prev => prev || '');
              }
            } catch (err) {
              console.error('Device initialization error:', err);
            } finally {
              if (tempStream) {
                tempStream.getTracks().forEach(track => track.stop());
              }
            }
          };

          void initDevices();
        }
      }, [open]);
      // CAMERA SELECT END

      // CAMERA SELECT START
      // 선반 QR 스트림 (선반 카메라)
      useEffect(() => {
        // 기존 스트림 정리
        const stopStream = () => {
          if (qrStreamRef.current) {
            qrStreamRef.current.getTracks().forEach(track => track.stop());
            qrStreamRef.current = null;
          }
          if (scanIntervalRef.current) {
            clearInterval(scanIntervalRef.current);
            scanIntervalRef.current = null;
          }
        };

        if (open && qrEnabled && shelfCameraId) {
          // 얼굴 카메라와 동일한 장치 선택 시 경고 및 스트림 차단
          if (faceCameraId && shelfCameraId === faceCameraId) {
            stopStream();
            setQrStatus('얼굴 카메라와 선반 카메라에 서로 다른 장치를 선택하세요.');
            return () => stopStream();
          }

          const constraints = {
            video: {
              deviceId: { exact: shelfCameraId },
              width: { ideal: 1280 },
              height: { ideal: 720 }
            },
            audio: false
          };

          navigator.mediaDevices.getUserMedia(constraints)
            .then(stream => {
              stopStream(); // 기존 스트림 정리 후 새 스트림 연결
              qrStreamRef.current = stream;
              if (qrVideoRef.current) {
                qrVideoRef.current.srcObject = stream;
                setQrStatus('카메라 연결됨 - QR 스캔 준비');
              }
            })
            .catch(err => {
              console.error('QR camera access error:', err);
              setQrStatus('카메라 접근 실패: ' + err.message);
            });
        } else {
          stopStream();
          setQrStatus('카메라 대기 중...');
        }

        return () => {
          stopStream();
        };
      }, [open, qrEnabled, shelfCameraId, faceCameraId]);
      // CAMERA SELECT END

      // 기준 상태 저장 (BEFORE)
      const handleSaveBefore = async () => {
        // CAMERA SELECT START
        // 얼굴 카메라와 선반 카메라가 동일한 장치면 스캔 차단
        if (faceCameraId && shelfCameraId && faceCameraId === shelfCameraId) {
          setQrStatus('얼굴 카메라와 선반 카메라에 서로 다른 장치를 선택하세요.');
          return;
        }
        // CAMERA SELECT END

        if (!qrVideoRef.current || !qrCanvasRef.current) {
          setQrStatus('카메라가 준비되지 않았습니다.');
          return;
        }

        setIsScanning(true);
        setQrStatus('QR 스캔 중... (2초)');
        
        try {
          const detected = await scanQRFromVideo(qrVideoRef.current, qrCanvasRef.current, 2000, 200);
          
          if (detected.length < 2) {
            setQrStatus(`경고: QR이 너무 적게 감지되었습니다 (${detected.length}개). 재시도해주세요.`);
            setIsScanning(false);
            return;
          }

          setBeforeQRs(detected);
          setQrStatus(`기준 상태 저장 완료: ${detected.length}개 QR 감지 (${detected.map(id => ITEM_MAP[id]).join(', ')})`);
        } catch (error) {
          console.error('Before scan error:', error);
          setQrStatus('스캔 오류: ' + error.message);
        } finally {
          setIsScanning(false);
        }
      };

      // 대여 확정 (After 비교)
      const handleCompareAfter = async () => {
        // CAMERA SELECT START
        // 얼굴 카메라와 선반 카메라가 동일한 장치면 스캔 차단
        if (faceCameraId && shelfCameraId && faceCameraId === shelfCameraId) {
          setQrStatus('얼굴 카메라와 선반 카메라에 서로 다른 장치를 선택하세요.');
          return;
        }
        // CAMERA SELECT END

        if (beforeQRs.length === 0) {
          setQrStatus('먼저 기준 상태를 저장해주세요.');
          return;
        }

        if (!qrVideoRef.current || !qrCanvasRef.current) {
          setQrStatus('카메라가 준비되지 않았습니다.');
          return;
        }

        setIsScanning(true);
        setQrStatus('1.5초 후 After 스캔 시작...');

        // 1.5초 대기
        await new Promise(resolve => setTimeout(resolve, 1500));

        setQrStatus('After QR 스캔 중... (2초)');

        try {
          const afterQRs = await scanQRFromVideo(qrVideoRef.current, qrCanvasRef.current, 2000, 200);

          if (afterQRs.length < 2) {
            setQrStatus(`경고: After QR이 너무 적게 감지되었습니다 (${afterQRs.length}개). 재시도해주세요.`);
            setIsScanning(false);
            return;
          }

          // before에는 있고 after에 없는 QR = 사라진 품목
          const takenIds = beforeQRs.filter(id => !afterQRs.includes(id));
          
          // 오탐 방지: after가 before보다 갑자기 많아진 경우
          if (afterQRs.length > beforeQRs.length + 1) {
            setQrStatus(`경고: After QR이 Before보다 많습니다 (Before: ${beforeQRs.length}, After: ${afterQRs.length}). 재시도해주세요.`);
            setIsScanning(false);
            return;
          }

          if (takenIds.length === 0) {
            setQrStatus('사라진 품목이 없습니다.');
            setAvailableItems([]);
            setSelectedItems([]);
            setIsScanning(false);
            return;
          }

          const takenNames = takenIds.map(id => ITEM_MAP[id]);
          setAvailableItems(takenNames);
          setSelectedItems(takenNames); // 기본으로 모두 선택
          setItemsTaken(takenNames);
          setQrStatus(`감지 완료: ${takenNames.length}개 품목 (${takenNames.join(', ')})`);
        } catch (error) {
          console.error('After scan error:', error);
          setQrStatus('스캔 오류: ' + error.message);
        } finally {
          setIsScanning(false);
        }
      };

      // QR 모듈 토글
      const toggleQR = () => {
        setQrEnabled(!qrEnabled);
        if (!qrEnabled) {
          setBeforeQRs([]);
          setAvailableItems([]);
          setSelectedItems([]);
          setItemsTaken([]);
        }
      };
      // QR AUTO ITEM LOG END

      // CAMERA SELECT START
      // 얼굴 인식 스트림 (얼굴 카메라)
      useEffect(() => {
        const stopFaceStream = () => {
          if (faceStreamRef.current) {
            faceStreamRef.current.getTracks().forEach(track => track.stop());
            faceStreamRef.current = null;
          }
        };

        if (open && faceCameraId) {
          const constraints = {
            video: {
              deviceId: { exact: faceCameraId }
            },
            audio: false
          };

          navigator.mediaDevices.getUserMedia(constraints)
            .then(stream => {
              stopFaceStream(); // 기존 스트림 정리 후 새 스트림 연결
              faceStreamRef.current = stream;
              if (faceVideoRef.current) {
                faceVideoRef.current.srcObject = stream;
              }
            })
            .catch(err => console.error('Face camera error:', err));
        } else {
          stopFaceStream();
        }

        return () => {
          stopFaceStream();
        };
      }, [open, faceCameraId]);
      // CAMERA SELECT END

      // 얼굴인식 실행 (예시 - 실제 구현은 face-api.js 등 사용)
      const handleFaceRecognition = () => {
        // TODO: 얼굴인식 로직 구현
        // 예시: setBorrowerName('홍길동'); setBorrowerTeam('개발팀');
        alert('얼굴인식 기능은 별도 구현이 필요합니다.');
      };

      // QR AUTO ITEM LOG START
      // 품목 선택 토글
      const toggleItemSelection = (item) => {
        setSelectedItems(prev => {
          const newSelection = prev.includes(item)
            ? prev.filter(i => i !== item)
            : [...prev, item];
          setItemsTaken(newSelection);
          return newSelection;
        });
      };
      // QR AUTO ITEM LOG END

      // 최종 확인
      const handleFinalConfirm = async () => {
        if (!borrowerName || !borrowerTeam) {
          alert('대여자 정보를 입력해주세요.');
          return;
        }

        // QR AUTO ITEM LOG START
        if (qrEnabled && selectedItems.length === 0) {
          alert('대여할 품목을 선택해주세요.');
          return;
        }
        // QR AUTO ITEM LOG END

        setIsProcessing(true);

        try {
          await onConfirm({
            borrowerName,
            borrowerTeam,
            itemsTaken: qrEnabled ? selectedItems : itemsTaken, // QR 사용 시 selectedItems, 아니면 기존 itemsTaken
          });

          // 초기화
          setBorrowerName('');
          setBorrowerTeam('');
          setItemsTaken([]);
          setAvailableItems([]);
          // QR AUTO ITEM LOG START
          setBeforeQRs([]);
          setSelectedItems([]);
          setQrEnabled(false);
          // QR AUTO ITEM LOG END
          onClose();
        } catch (error) {
          console.error('Confirm error:', error);
          alert('대여 처리 중 오류가 발생했습니다.');
        } finally {
          setIsProcessing(false);
        }
      };

      if (!open) return null;

      const getDeviceLabel = (device, index) => {
        const baseLabel = device.label && device.label.length > 0
          ? device.label
          : `Camera ${index + 1}`;
        const idSuffix = device.deviceId ? device.deviceId.slice(0, 6) : '';
        return idSuffix ? `${baseLabel} (${idSuffix}...)` : baseLabel;
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white rounded-lg p-6 max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <h2 className="text-2xl font-bold mb-4">자산 대여</h2>

            {/* 얼굴인식 영역 */}
            <div className="mb-4">
              <label className="block text-sm font-medium mb-2">얼굴 인식 (자동 입력)</label>
              {/* CAMERA SELECT START */}
              {/* 얼굴 카메라 선택 */}
              {devices.length > 0 && (
                <div className="mb-2">
                  <label className="block text-xs text-gray-600 mb-1">얼굴 카메라 선택</label>
                  <select
                    value={faceCameraId}
                    onChange={(e) => setFaceCameraId(e.target.value)}
                    className="w-full border rounded px-3 py-1 text-sm"
                  >
                    {devices.map((device, index) => (
                      <option key={device.deviceId} value={device.deviceId}>
                        {getDeviceLabel(device, index)}
                      </option>
                    ))}
                  </select>
                </div>
              )}
              {/* CAMERA SELECT END */}
              <div className="relative">
                <video
                  ref={faceVideoRef}
                  autoPlay
                  playsInline
                  muted
                  className="w-full h-48 bg-black rounded"
                />
                <button
                  onClick={handleFaceRecognition}
                  className="absolute bottom-2 right-2 bg-blue-500 text-white px-3 py-1 rounded text-sm"
                >
                  인식
                </button>
              </div>
            </div>

            {/* 대여자 정보 */}
            <div className="grid grid-cols-2 gap-4 mb-4">
              <div>
                <label className="block text-sm font-medium mb-1">이름 *</label>
                <input
                  type="text"
                  value={borrowerName}
                  onChange={(e) => setBorrowerName(e.target.value)}
                  placeholder="대여자 이름"
                  className="w-full border rounded px-3 py-2"
                />
              </div>
              <div>
                <label className="block text-sm font-medium mb-1">팀 *</label>
                <input
                  type="text"
                  value={borrowerTeam}
                  onChange={(e) => setBorrowerTeam(e.target.value)}
                  placeholder="소속 팀"
                  className="w-full border rounded px-3 py-2"
                />
              </div>
            </div>

            {/* QR AUTO ITEM LOG START */}
            {/* 선반 카메라(품목 인식) 섹션 */}
            <div className="mb-4 border-t pt-4">
              <div className="flex items-center justify-between mb-2">
                <label className="flex items-center">
                  <input
                    type="checkbox"
                    checked={qrEnabled}
                    onChange={toggleQR}
                    className="mr-2"
                  />
                  <span className="font-medium">선반 카메라로 품목 자동 기록(QR)</span>
                </label>
              </div>

              {qrEnabled && (
                <div className="mt-3 space-y-3">
                  {/* CAMERA SELECT START */}
                  {/* 선반 카메라 장치 선택 */}
                  {devices.length >= 2 && (
                    <div>
                      <label className="block text-sm font-medium mb-1">선반 카메라 선택</label>
                      <select
                        value={shelfCameraId}
                        onChange={(e) => setShelfCameraId(e.target.value)}
                        className="w-full border rounded px-3 py-2 text-sm"
                      >
                        {devices.map((device, index) => (
                          <option key={device.deviceId} value={device.deviceId}>
                            {getDeviceLabel(device, index)}
                          </option>
                        ))}
                      </select>
                    </div>
                  )}
                  {devices.length < 2 && (
                    <div className="text-sm text-red-600 bg-red-50 border border-red-200 rounded p-2">
                      웹캠 2대가 필요합니다(얼굴/선반 분리).
                    </div>
                  )}
                  {/* CAMERA SELECT END */}

                  {/* CAMERA SELECT START */}
                  {/* 같은 deviceId 선택 시 경고 표시 */}
                  {faceCameraId && shelfCameraId && faceCameraId === shelfCameraId && (
                    <div className="text-sm text-red-600 bg-red-50 border border-red-200 rounded p-2">
                      얼굴 카메라와 선반 카메라에 서로 다른 장치를 선택하세요.
                    </div>
                  )}
                  {/* CAMERA SELECT END */}

                  {/* 비디오 프리뷰 */}
                  <div className="relative">
                    <video
                      ref={qrVideoRef}
                      autoPlay
                      playsInline
                      muted
                      className="w-full h-48 bg-black rounded"
                    />
                    <canvas ref={qrCanvasRef} className="hidden" />
                  </div>

                  {/* 상태 텍스트 */}
                  <div className="text-sm text-gray-600 bg-gray-100 p-2 rounded">
                    {qrStatus}
                  </div>

                  {/* 버튼들 */}
                  <div className="flex gap-2">
                    <button
                      onClick={handleSaveBefore}
                      disabled={isScanning}
                      className="flex-1 bg-green-500 text-white px-4 py-2 rounded disabled:bg-gray-400"
                    >
                      {isScanning ? '스캔 중...' : '기준 상태 저장(BEFORE)'}
                    </button>
                    <button
                      onClick={handleCompareAfter}
                      disabled={isScanning || beforeQRs.length === 0}
                      className="flex-1 bg-blue-500 text-white px-4 py-2 rounded disabled:bg-gray-400"
                    >
                      {isScanning ? '스캔 중...' : '대여 확정(After 비교)'}
                    </button>
                  </div>

                  {/* 기준 상태 표시 */}
                  {beforeQRs.length > 0 && (
                    <div className="text-sm text-gray-600">
                      기준 상태: {beforeQRs.map(id => ITEM_MAP[id]).join(', ')}
                    </div>
                  )}

                  {/* 감지된 반출 품목 확인 */}
                  {availableItems.length > 0 && (
                    <div className="border rounded p-3 bg-yellow-50">
                      <label className="block font-medium mb-2">감지된 반출 품목 (확인 및 선택)</label>
                      <div className="space-y-2 max-h-40 overflow-y-auto">
                        {availableItems.map((item) => (
                          <label key={item} className="flex items-center space-x-2 cursor-pointer">
                            <input
                              type="checkbox"
                              checked={selectedItems.includes(item)}
                              onChange={() => toggleItemSelection(item)}
                              className="w-4 h-4"
                            />
                            <span className="text-sm">{item}</span>
                          </label>
                        ))}
                      </div>
                      <div className="mt-2 text-sm text-gray-600">
                        선택된 품목: {selectedItems.length}개
                      </div>
                    </div>
                  )}
                </div>
              )}
            </div>
            {/* QR AUTO ITEM LOG END */}

            {/* 기존 품목 입력 (QR 비활성화 시) */}
            {!qrEnabled && (
              <div className="mb-4">
                <label className="block text-sm font-medium mb-2">대여 품목 (수동 입력)</label>
                <input
                  type="text"
                  value={itemsTaken.join(', ')}
                  onChange={(e) => setItemsTaken(e.target.value.split(',').map(s => s.trim()).filter(Boolean))}
                  placeholder="품목명을 쉼표로 구분"
                  className="w-full border rounded px-3 py-2"
                />
              </div>
            )}

            {/* 버튼 */}
            <div className="flex justify-end gap-2 mt-6">
              <button
                onClick={onClose}
                disabled={isProcessing}
                className="px-4 py-2 border rounded disabled:opacity-50"
              >
                취소
              </button>
              <button
                onClick={handleFinalConfirm}
                disabled={isProcessing || (qrEnabled ? selectedItems.length === 0 : itemsTaken.length === 0)}
                className="px-4 py-2 bg-blue-500 text-white rounded disabled:bg-gray-400"
              >
                {isProcessing ? '처리 중...' : '확인'}
              </button>
            </div>
          </div>
        </div>
      );
    }

    // 메인 앱 컴포넌트
    function App() {
      const [loanModalOpen, setLoanModalOpen] = useState(false);
      const [loanLogs, setLoanLogs] = useState([]);

      const handleLoanConfirm = async (data) => {
        const newLog = {
          id: Date.now().toString(),
          ...data,
          timestamp: new Date().toISOString(),
        };

        setLoanLogs(prev => [newLog, ...prev]);
        
        // TODO: 실제 API 호출
        // await fetch('/api/loan/save', { method: 'POST', body: JSON.stringify(newLog) });
        
        console.log('대여 저장:', newLog);
      };

      return (
        <div className="container mx-auto py-8 px-4">
          <div className="flex justify-between items-center mb-6">
            <div>
              <h1 className="text-3xl font-bold">자산/소모품 대여 관리</h1>
              <p className="text-gray-600 mt-2">QR 스캔 기반 자동 품목 인식 시스템</p>
            </div>
            <button
              onClick={() => setLoanModalOpen(true)}
              className="bg-blue-500 text-white px-6 py-2 rounded hover:bg-blue-600"
            >
              대여 신청
            </button>
          </div>

          {/* 대여 내역 */}
          <div className="bg-white rounded-lg shadow p-6">
            <h2 className="text-xl font-semibold mb-4">대여 내역</h2>
            {loanLogs.length === 0 ? (
              <p className="text-gray-500 text-center py-8">대여 내역이 없습니다.</p>
            ) : (
              <div className="space-y-4">
                {loanLogs.map((log) => (
                  <div key={log.id} className="border rounded-lg p-4">
                    <div className="flex justify-between items-start mb-2">
                      <div>
                        <p className="font-semibold">{log.borrowerName} ({log.borrowerTeam})</p>
                        <p className="text-sm text-gray-500">
                          {new Date(log.timestamp).toLocaleString('ko-KR')}
                        </p>
                      </div>
                    </div>
                    <div className="flex flex-wrap gap-2">
                      {log.itemsTaken.map((item, idx) => (
                        <span key={idx} className="px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm">
                          {item}
                        </span>
                      ))}
                    </div>
                  </div>
                ))}
              </div>
            )}
          </div>

          <LoanModal
            open={loanModalOpen}
            onClose={() => setLoanModalOpen(false)}
            onConfirm={handleLoanConfirm}
          />
        </div>
      );
    }

    // React 렌더링
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

    /* 
    ========================================
    테스트 순서:
    ========================================
    1. 브라우저에서 index.html 열기
    2. "대여 신청" 버튼 클릭
    3. 얼굴인식 영역에서 "인식" 버튼 클릭 (또는 수동 입력)
    4. 이름과 팀 입력
    5. "선반 카메라로 품목 자동 기록(QR)" 체크박스 활성화
    6. 카메라 선택 (C920이 있다면 선택)
    7. 선반이 보이도록 카메라 위치 조정
    8. "기준 상태 저장(BEFORE)" 버튼 클릭
       - 2초간 QR 스캔 진행
       - 최소 2개 이상 QR 감지되어야 함
    9. 품목을 선반에서 가져가기
    10. "대여 확정(After 비교)" 버튼 클릭
        - 1.5초 대기 후 2초간 QR 스캔 진행
        - 사라진 QR 감지하여 품목 목록 생성
    11. 감지된 품목 목록에서 확인 및 체크박스로 선택/해제
    12. "확인" 버튼 클릭하여 대여 저장
    13. 대여 내역에 저장된 내용 확인

    주의사항:
    - 카메라 권한 허용 필요
    - QR 코드가 선명하게 보여야 정확한 감지 가능
    - 조명이 충분해야 함
    - QR이 2개 미만 감지되면 재시도 권장
    ========================================
    */
  </script>

</body>
</html>
